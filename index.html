<!DOCTYPE html>
<HTML lang="en">
<HEAD>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="stylesheet/Main.css">
</HEAD>

<BODY>
<DIV id="RedirectControl">
    <p>Steam://openurl/ <input type="text" id="urlInput" placeholder="Enter URL"></p>

    <button onclick="getRedirect()">Create and copy the redirect link</button>
</DIV>

<DIV id="Redirecting">
    <p id="description">Someone wishes to redirect you towards:<br></p>
    <button onclick="openBrowser()">Continue</button>
    <button onclick="openSteam()">Open in Steam</button>
</DIV>

<SCRIPT>
      function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
      };

      function getRedirect(){
        const targetURL = document.getElementById("urlInput").value;
        if (targetURL.trim() !== '')
          navigator.clipboard.writeText("https://project-zomboid-community-modding.github.io/?url=" + targetURL);
        else
          alert("Please enter a valid URL.");
      }

      function openBrowser(){
        window.open(urlParam, "_self");
      }

      function openSteam(){
        window.open('steam://openurl/' + urlParam, "_self")
        window.close();
      }

      window.onload = function(){
        urlParam = getUrlParameter('url');
        if (urlParam !== '') {
	  let ih = document.getElementById("description");
	  ih.innerHTML = `${ih.innerHTML}<a href="${urlParam}">${urlParam}</a>`;
	  console.log(ih.innerHTML);
          document.getElementById("RedirectControl").remove();
	} else {
	  console.log("Removing redirecting");
          document.getElementById("Redirecting").remove();
	}
      }
    </SCRIPT>

</BODY>
</HTML>